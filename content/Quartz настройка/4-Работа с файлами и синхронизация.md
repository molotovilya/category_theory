---
title: 4.Работа с переносом заметок, очистка гита и скрытие заметок
---
# Quartz: Workflow и улучшения

## 🔒 Скрытие заметок

Чтобы заметка **не отображалась** на сайте, но оставалась в Git-репозитории:

```yaml
---
draft: true
---
````

Добавить это свойство в начало файла. Quartz пропустит её при сборке, но файл останется в истории и хранилище.

**Применение:**

- Черновики
- WIP-заметки
- Личные записи, которые не нужно публиковать

Чтобы опубликовать позже - удали свойство 

---

## 📝 Правила именования файлов

### ❌ Избегать

- Цифры с пробелами: `1. название файла.md`
- Спецсимволы и знаки пунктуации
- Слишком длинные названия

### ✅ Лучше использовать

- Kebab-case: `category-theory-basics.md`
- CamelCase: `CategoryTheoryBasics.md`
- Простые названия без префиксов: `functors.md`

**Причина:** Quartz и URL генерация работают стабильнее без пробелов и цифровых префиксов. Иначе будет выдавать 404 ошибку 

> [!idea]- Управление названием файлов
> Чтобы получить названия вида `1. название файла` в проводнике , используйте свойство `title` в верху страницы. Тогда название заметки и название в проводнике будет не именем файла, а указанным.

---

## 🚀 Автоматизация: Deploy скрипт

Для написания заметок я использую Obsidian.. И в нём есть отдельная папка, которая содержит все материалы хранилища 
	- 6. category_theory

Я сделал локальный репозиторий хранилища-сайта с Git. 
Чтобы отправить заметки - копирую файлы из папки Obsidian  и пушу. 

Написал `deploy.bat` для автоматизации всего процесса от синхронизации до публикации. Также добавил возможность только локально запускать хранилище и чистить историю на Git.


> [!example]- Скрипт deploy.bat
> ```bash title="deploy.bat"
> @echo off
> setlocal enabledelayedexpansion
> 
> REM ========================================
> REM НАСТРОЙКА GITHUB CLI PATH
> REM ========================================
> set "GH_PATH=C:\Program Files\GitHub CLI"
> if exist "%GH_PATH%\gh.exe" (
>     set "PATH=%GH_PATH%;%PATH%"
> )
> 
> echo ========================================
> echo     Quartz - Синхронизация и публикация
> echo ========================================
> echo.
> set SOURCE=C:\Users\user\Doc\cor\6. category_theory
> set DEST=content
> set GITHUB_REPO=molotovilya/category_theory
> 
> echo Синхронизация файлов...
> robocopy "%SOURCE%" "%DEST%" /MIR /XD .git .obsidian /NJH /NJS /NDL /NC /NS
> 
> echo Очистка кэша Quartz...
> rmdir /s /q .quartz-cache 2>nul
> rmdir /s /q public 2>nul
> 
> echo.
> echo ========================================
> echo     Выберите действия (комбинируйте):
> echo ========================================
> echo     1 - Локальный запуск
> echo     2 - Git push
> echo     3 - Полная очистка (коммиты + deployments + actions)
> echo ----------------------------------------
> echo     Примеры:
> echo       1   - только локально
> echo       2   - только git push
> echo       12  - git push + локально
> echo       23  - очистка + git push
> echo       123 - всё вместе
> echo ========================================
> echo.
> set /p action="Ваш выбор: "
> 
> if "%action%"=="" goto end
> 
> REM Проверяем наличие каждой цифры
> set DO_LOCAL=0
> set DO_PUSH=0
> set DO_CLEAN=0
> 
> echo %action% | findstr "1" >nul && set DO_LOCAL=1
> echo %action% | findstr "2" >nul && set DO_PUSH=1
> echo %action% | findstr "3" >nul && set DO_CLEAN=1
> 
> REM Если ничего не выбрано
> if %DO_LOCAL%==0 if %DO_PUSH%==0 if %DO_CLEAN%==0 (
>     echo ❌ Неверный выбор!
>     pause
>     goto end
> )
> 
> REM Показываем план
> echo.
> echo ========================================
> echo     План действий:
> echo ========================================
> if %DO_CLEAN%==1 echo   ✓ Полная очистка (коммиты, deployments, actions)
> if %DO_PUSH%==1 echo   ✓ Git push
> if %DO_LOCAL%==1 echo   ✓ Локальный запуск
> echo ========================================
> echo.
> 
> REM Подтверждение для очистки
> if %DO_CLEAN%==1 (
>     echo ⚠️  ВНИМАНИЕ! Будет удалено:
>     echo   - Вся история коммитов
>     echo   - Все deployments
>     echo   - Все workflow runs
>     set /p confirm="Подтвердить? (1 - да, Enter - отмена): "
>     if not "!confirm!"=="1" (
>         echo Отменено.
>         goto end
>     )
> )
> 
> echo.
> echo Начинаю выполнение...
> echo.
> 
> REM ========================================
> REM ПОЛНАЯ ОЧИСТКА (если выбрано)
> REM ========================================
> if %DO_CLEAN%==1 (
>     echo ========================================
>     echo     ПОЛНАЯ ОЧИСТКА
>     echo ========================================
>     echo.
>     
>     REM 1. Сброс истории коммитов
>     echo [1/3] Сброс истории коммитов...
>     rmdir /s /q .git 2>nul
>     git init
>     git add .
>     git commit -m "Initial commit: Category Theory notes"
>     git remote add origin https://github.com/%GITHUB_REPO%.git
>     git push -u origin main --force
>     echo ✅ История обнулена
>     echo.
>     
>     REM Проверка gh CLI
>     echo Проверка GitHub CLI...
>     
>     where gh >nul 2>nul
>     if errorlevel 1 (
>         echo ⚠️  GitHub CLI не найден
>         echo ⚠️  Пропускаю очистку deployments и actions
>         goto skip_clean
>     )
>     
>     echo ✅ GitHub CLI найден
>     
>     REM Проверяем авторизацию
>     gh auth status >nul 2>nul
>     if errorlevel 1 (
>         echo ⚠️  GitHub CLI не авторизован
>         echo ⚠️  Выполни: gh auth login
>         goto skip_clean
>     )
>     echo ✅ GitHub CLI авторизован
>     echo.
>     
>     REM 2. Очистка deployments
>     echo [2/3] Очистка deployments...
>     echo.
>     
>     REM Получаем список deployments
>     echo Получение списка deployments...
>     gh api repos/%GITHUB_REPO%/deployments --jq ".[].id" > temp_deployments.txt 2>temp_error.txt
>     
>     if exist temp_error.txt (
>         type temp_error.txt
>         del temp_error.txt
>     )
>     
>     if exist temp_deployments.txt (
>         for %%A in (temp_deployments.txt) do set filesize=%%~zA
>         if !filesize! GTR 2 (
>             set /a count=0
>             for /f "usebackq delims=" %%i in (temp_deployments.txt) do (
>                 set /a count+=1
>                 echo.
>                 echo [!count!] Обработка deployment %%i
>                 
>                 REM Получаем все статусы
>                 echo   → Получение статусов...
>                 gh api repos/%GITHUB_REPO%/deployments/%%i/statuses --jq ".[].id" > temp_statuses.txt 2>nul
>                 
>                 REM Удаляем все статусы
>                 if exist temp_statuses.txt (
>                     for /f "usebackq delims=" %%s in (temp_statuses.txt) do (
>                         echo   → Удаление статуса %%s
>                         gh api -X DELETE repos/%GITHUB_REPO%/deployments/%%i/statuses/%%s 2>nul
>                     )
>                     del temp_statuses.txt
>                 )
>                 
>                 REM Деактивируем deployment
>                 echo   → Деактивация...
>                 gh api -X POST repos/%GITHUB_REPO%/deployments/%%i/statuses -f state=inactive 2>nul
>                 
>                 REM Пробуем удалить
>                 echo   → Удаление...
>                 gh api -X DELETE repos/%GITHUB_REPO%/deployments/%%i 2>temp_del_error.txt
>                 
>                 if exist temp_del_error.txt (
>                     echo   ⚠️ Ошибка удаления:
>                     type temp_del_error.txt
>                     del temp_del_error.txt
>                 ) else (
>                     echo   ✅ Удалено
>                 )
>             )
>             echo.
>             echo ✅ Обработано deployments: !count!
>         ) else (
>             echo ✅ Deployments не найдены
>         )
>         del temp_deployments.txt
>     ) else (
>         echo ⚠️ Не удалось получить список deployments
>     )
>     echo.
>     
>     REM 3. Очистка workflow runs
>     echo [3/3] Очистка workflow runs...
>     powershell -Command "& { $ErrorActionPreference='SilentlyContinue'; try { $runs = gh api repos/%GITHUB_REPO%/actions/runs?per_page=100 | ConvertFrom-Json; $count = $runs.workflow_runs.Count; if ($count -eq 0) { Write-Host '   ✅ Runs уже очищены' } else { Write-Host \"   Найдено: $count runs\"; $i=0; foreach($r in $runs.workflow_runs) { $i++; Write-Host \"   → Удаление run $i/$count\"; gh api -X DELETE repos/%GITHUB_REPO%/actions/runs/$($r.id) | Out-Null }; Write-Host \"   ✅ Удалено: $i\" } } catch { Write-Host '   ⚠️  Ошибка получения runs' } }"
>     echo.
>     
>     :skip_clean
>     echo ✅ Полная очистка завершена!
>     echo.
> )
> 
> REM ========================================
> REM GIT PUSH (если выбрано)
> REM ========================================
> if %DO_PUSH%==1 (
>     echo ========================================
>     echo     GIT PUSH
>     echo ========================================
>     echo.
>     
>     REM Если была очистка, push уже сделан
>     if %DO_CLEAN%==1 (
>         echo ✓ Push уже выполнен при очистке
>         echo.
>     ) else (
>         git status --short
>         git add .
>         git commit -m "Update: %date% %time%"
>         git push origin main
>         echo.
>         echo ✅ Файлы отправлены на GitHub!
>         echo    https://molotovilya.github.io/category_theory
>         echo.
>     )
> )
> 
> REM ========================================
> REM ЛОКАЛЬНЫЙ ЗАПУСК (если выбрано)
> REM ========================================
> if %DO_LOCAL%==1 (
>     echo ========================================
>     echo     ЛОКАЛЬНЫЙ ЗАПУСК
>     echo ========================================
>     echo.
>     call npx quartz build
>     echo.
>     echo ✅ Сборка завершена! Запуск сервера...
>     echo    http://localhost:8080
>     echo.
>     npx http-server public -p 8080 -o
> )
> 
> :end
> echo.
> echo ========================================
> echo     ✅ Всё готово!
> echo ========================================
> pause
> ```


### Что делает скрипт

1. **Синхронизация**: Копирует файлы из Obsidian vault в Quartz (`robocopy`)
2. **Очистка кэша**: Удаляет `.quartz-cache` и `public`
3. **Три режима работы**:
    - **1** — Локальный запуск (сборка + preview на `localhost:8080`)
    - **2** — Git push (коммит + отправка на GitHub)
    - **3** — Полная очистка (история коммитов + deployments + workflow runs)
- при запуске можно использовать комбинированные режими 12, 23, 123

```bash
# Только локальный preview
> 1

# Git push без локального запуска
> 2

# Комбинация: очистка + push + локально
> 123
```

### Ключевые особенности

- **Безопасность**: подтверждение перед полной очисткой
- **Очистка истории** Git: сброс до одного initial commit
- **GitHub CLI**: автоматическая очистка deployments и actions через `gh`

обратите внимание, что должен быть установлен GitHub CL. В скрипте к нему прописан отдельный путь - проверьте какой у вас. 


### Структура копирования

```
C:\Users\user\Doc\cor\6. category_theory  →  [robocopy]  →  content/
                                                ↓
                                          [Git push]
                                                ↓
                                    GitHub Pages deploy
```

---

## 🎯 Итоговый workflow

1. Пишу заметки в Obsidian
2. Готовые заметки: `draft: false` (или вообще без свойства)
3. Черновики: `draft: true`
4. Запускаю `deploy.bat` с нужными опциями
5. Сайт автоматически обновляется через GitHub Actions

**Результат:** Полностью автоматизированный процесс публикации с контролем видимости заметок.



